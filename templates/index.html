<!DOCTYPE html>
<html>
<head>
    <title>my PA</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha384-rf4y5R8OGtB6HIbbVYB21O2mR2JW4bsI5sRj5f5C5epX4pBdr6B5Bd5Hf5Fj5F5N5m" crossorigin="anonymous">

</head>
<body>
    <h1>To-Do </h1>
    <form action="/add" method="POST">
        <label for="task">Task:</label>
        <input type="text" id="task" name="task" required>
        <label for="time">Due Time:</label>
        <input type="datetime-local" id="time" name="time" required>
        <button type="submit">Add Task</button>
    </form>
    <h2>Task List</h2>
    <ul>
        {% for reminder in reminders %}
            <li>{{ reminder.task }} (Due at {{ reminder.time }})</li>
        {% endfor %}
    </ul>
    <ul>
    {% for reminder in reminders %}
        <li>
            <i class="fas fa-whatsapp"></i>
            <i class="fas fa-phone"></i>
            {{ reminder.task }} (Due at {{ reminder.time }})
        </li>
    {% endfor %}
    <h3>overdue tasks</h3>
    <ul>
    {% for reminder in reminders %}
        <li {% if reminder.overdue %}class="overdue"{% endif %}>
            <i class="fas fa-whatsapp"></i>
            <i class="fas fa-phone"></i>
            {{ reminder.task }} (Due at {{ reminder.time }})
        </li>
    {% endfor %}
    <li {% if reminder.overdue %}class ="overdue{% endif %}">
        <i class="fas fa-whatsapp"></i>
    <i class="fas fa-phone"></i>
    {{ reminder.task }} (Due at {{ reminder.time }}) - {% if not reminder.overdue %}Time Remaining: <span id="timer_{{ loop.index }}"></span>{% endif %}
    </li>
<script>
    {% for reminder in reminders %}
        {% if not reminder.overdue %}
            var timer_{{ loop.index }} = document.getElementById("timer_{{ loop.index }}");
            var time_remaining_{{ loop.index }} = {{ reminder.time_remaining }};
            
            function updateTimer_{{ loop.index }}() {
                var hours = Math.floor(time_remaining_{{ loop.index }} / 3600);
                var minutes = Math.floor((time_remaining_{{ loop.index }} % 3600) / 60);
                var seconds = Math.floor(time_remaining_{{ loop.index }} % 60);
                
                timer_{{ loop.index }}.innerText = hours + "h " + minutes + "m " + seconds + "s";
                
                if (time_remaining_{{ loop.index }} > 0) {
                    time_remaining_{{ loop.index }}--;
                    setTimeout(updateTimer_{{ loop.index }}, 1000);
                } else {
                    timer_{{ loop.index }}.innerText = "Time's up!";
                }
            }
            
            updateTimer_{{ loop.index }}();
        {% endif %}
    {% endfor %}    
</script>
</body>
</html>
